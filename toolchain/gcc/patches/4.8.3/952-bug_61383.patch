[4.8/4.9/4.10 Regression] wrong code at -O2 and -O3 on x86_64-linux-gnu

 http://gcc.gnu.org/bugzilla/show_bug.cgi?id=61383

--- gcc-4_8-branch/gcc/ChangeLog	(revision 211231)
+++ gcc-4_8-branch/gcc/ChangeLog	(revision 211232)
@@ -1,6 +1,12 @@
 	* config/arm/arm.c (arm_output_mi_thunk): Fix offset for
 	TARGET_THUMB1_ONLY. Add comments.
 
+2014-06-04  Richard Biener  <rguenther@suse.de>
+
+	PR tree-optimization/61383
+	* tree-ssa-ifcombine.c (bb_no_side_effects_p): Make sure
+	stmts can't trap.
+
 2014-06-03  Andrey Belevantsev  <abel@ispras.ru>
 
 	Backport from mainline
--- gcc-4_8-branch/gcc/testsuite/gcc.dg/torture/pr61383-1.c	(revision 0)
+++ gcc-4_8-branch/gcc/testsuite/gcc.dg/torture/pr61383-1.c	(revision 211232)
@@ -0,0 +1,35 @@
+/* { dg-do run } */
+
+int a, b = 1, c, d, e, f, g;
+
+int
+fn1 ()
+{
+  int h;
+  for (;;)
+    {
+      g = b;
+      g = g ? 0 : 1 % g;
+      e = a + 1;
+      for (; d < 1; d = e)
+	{
+	  if (f == 0)
+	    h = 0;
+	  else
+	    h = 1 % f;
+	  if (f < 1)
+	    c = 0;
+	  else if (h)
+	    break;
+	}
+      if (b)
+	return 0;
+    }
+}
+
+int
+main ()
+{
+  fn1 ();
+  return 0;
+}
--- gcc-4_8-branch/gcc/tree-ssa-ifcombine.c	(revision 211231)
+++ gcc-4_8-branch/gcc/tree-ssa-ifcombine.c	(revision 211232)
@@ -105,7 +105,11 @@ bb_no_side_effects_p (basic_block bb)
     {
       gimple stmt = gsi_stmt (gsi);
 
+      if (is_gimple_debug (stmt))
+	continue;
+
       if (gimple_has_side_effects (stmt)
+	  || gimple_could_trap_p (stmt)
 	  || gimple_vuse (stmt))
 	return false;
     }
