[4.5 Regression] Internal error in gimplify_expr

 http://gcc.gnu.org/bugzilla/show_bug.cgi?id=48742

--- gcc-4_5-branch/gcc/ChangeLog	(revision 173325)
+++ gcc-4_5-branch/gcc/ChangeLog	(revision 173326)
@@ -1,6 +1,12 @@
 2011-05-03  Jakub Jelinek  <jakub@redhat.com>
 
 	Backport from mainline
+	2011-04-27  Jakub Jelinek  <jakub@redhat.com>
+
+	PR c/48742
+	* c-typeck.c (build_binary_op): Don't wrap arguments if
+	int_operands is true.
+
 	2011-04-23  Jakub Jelinek  <jakub@redhat.com>
 
 	PR c/48685
--- gcc-4_5-branch/gcc/testsuite/gcc.c-torture/compile/pr48742.c	(revision 0)
+++ gcc-4_5-branch/gcc/testsuite/gcc.c-torture/compile/pr48742.c	(revision 173326)
@@ -0,0 +1,15 @@
+/* PR c/48742 */
+
+void baz (int);
+
+int
+foo (void)
+{
+  return 1 / 0 > 0;
+}
+
+void
+bar (void)
+{
+  baz (1 <= 2 % (3 >> 1 > 5 / 6 == 3));
+}
--- gcc-4_5-branch/gcc/testsuite/ChangeLog	(revision 173325)
+++ gcc-4_5-branch/gcc/testsuite/ChangeLog	(revision 173326)
@@ -1,6 +1,11 @@
 2011-05-03  Jakub Jelinek  <jakub@redhat.com>
 
 	Backport from mainline
+	2011-04-27  Jakub Jelinek  <jakub@redhat.com>
+
+	PR c/48742
+	* gcc.c-torture/compile/pr48742.c: New test.
+
 	2011-04-23  Jakub Jelinek  <jakub@redhat.com>
 
 	PR c/48685
--- gcc-4_5-branch/gcc/c-typeck.c	(revision 173325)
+++ gcc-4_5-branch/gcc/c-typeck.c	(revision 173326)
@@ -9800,7 +9800,7 @@ build_binary_op (location_t location, enum tree_co
 		warn_for_sign_compare (location, orig_op0_folded,
 				       orig_op1_folded, op0, op1,
 				       result_type, resultcode);
-	      if (!in_late_binary_op)
+	      if (!in_late_binary_op && !int_operands)
 		{
 		  if (!op0_maybe_const || TREE_CODE (op0) != INTEGER_CST)
 		    op0 = c_wrap_maybe_const (op0, !op0_maybe_const);
