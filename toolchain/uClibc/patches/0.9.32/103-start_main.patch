 Add compatibility with old uClibc versions less than 0.9.28 but newer than 0.9.15
  dl-hash.c name mapper adds thunk to  __uClibc_start_main  function

diff -urBp uClibc-0.9.30.1/ldso/ldso/dl-hash.c uClibc/ldso/ldso/dl-hash.c
--- a/ldso/ldso/dl-hash.c
+++ b/ldso/ldso/dl-hash.c
@@ -268,6 +268,23 @@ _dl_lookup_sysv_hash(struct elf_resolve
 	return NULL;
 }
 
+/* Add compatibility with old uClibc versions less than 0.9.28 but newer than 0.9.15 */
+#ifdef __LDSO_GNU_HASH_SUPPORT__
+static const Elf_Symndx _Start_Old_main_gnu_hash = 0xf6bfaf46;	// _dl_gnu_hash("__uClibc_start_main")
+#endif
+static const Elf_Symndx _Start_Old_main_elf_hash = 0x047b3fee;	// _dl_elf_hash("__uClibc_start_main")
+
+static void (*_uClibc_main)(void *main, int argc, char **argv,
+	     void (*app_init)(void), void (*app_fini)(void),
+	     void (*rtld_fini)(void), void *stack_end) = NULL;
+static void *_main = NULL;
+
+static void __uClibc_start_main(int argc, char **argv, char **envp,
+            void (*app_fini)(void), void (*app_init)(void))
+{
+    (*_uClibc_main)(_main, argc, argv, app_init, app_fini, NULL, NULL);
+}
+
 /*
  * This function resolves externals, and this is either called when we process
  * relocations or when we call an entry in the PLT table for the first time.
@@ -326,6 +343,11 @@ char *_dl_find_hash(const char *name, st
 			if (sym != NULL)
 				/* If sym has been found, do not search further */
 				break;
+
+			/* Check for unresolved old main entry */
+			if (gnu_hash_number == _Start_Old_main_gnu_hash)
+				goto chk_old_main;
+			}
 		} else {
 #endif
 		/* Use the old SysV-style hash table */
@@ -337,6 +359,19 @@ char *_dl_find_hash(const char *name, st
 		sym = _dl_lookup_sysv_hash(tpnt, symtab, elf_hash_number, name, type_class);
 		if (sym != NULL)
 			break;
+
+		if (elf_hash_number == _Start_Old_main_elf_hash) {
+#ifdef __LDSO_GNU_HASH_SUPPORT__
+ chk_old_main:
+#endif
+				/* main() must be single per executable */
+				if (_uClibc_main == NULL && _dl_strcmp("__uClibc_start_main\0", name) == 0) {
+					_main = _dl_find_hash("main", rpnt, mytpnt, type_class, NULL);
+					_uClibc_main = (void *)_dl_find_hash("__uClibc_main", rpnt, mytpnt, type_class, NULL);
+					_dl_debug_early("__uClibc_start_main thunk: __uClibc_main=%x, main=%x\n", _uClibc_main, _main);
+					return (char *) &__uClibc_start_main;
+				}
+		}
 #ifdef __LDSO_GNU_HASH_SUPPORT__
 		}
 #endif
-- 
